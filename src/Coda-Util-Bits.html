<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Coda/Util/Bits.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE MagicHash #-}</span>
<a name="line-3"></a>
<a name="line-4"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-5"></a><span class='hs-comment'>-- |</span>
<a name="line-6"></a><span class='hs-comment'>-- Copyright   :  (c) Edward Kmett 2017 (c) Clark Gaebel 2012, (c) Johan Tibel 2012</span>
<a name="line-7"></a><span class='hs-comment'>-- License     :  BSD-style</span>
<a name="line-8"></a><span class='hs-comment'>-- Maintainer  :  ekmett@gmail.com</span>
<a name="line-9"></a><span class='hs-comment'>-- Portability :  non-portable</span>
<a name="line-10"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Coda</span><span class='hs-varop'>.</span><span class='hs-conid'>Util</span><span class='hs-varop'>.</span><span class='hs-conid'>Bits</span>
<a name="line-13"></a>  <span class='hs-layout'>(</span> <span class='hs-varid'>highestBitMask</span>
<a name="line-14"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>shiftLL</span>
<a name="line-15"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>shiftRL</span>
<a name="line-16"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>wordSize</span>
<a name="line-17"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-18"></a>
<a name="line-19"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Bits</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>.|.</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>xor</span><span class='hs-layout'>,</span> <span class='hs-varid'>finiteBitSize</span><span class='hs-layout'>)</span>
<a name="line-20"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC</span><span class='hs-varop'>.</span><span class='hs-conid'>Exts</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC</span><span class='hs-varop'>.</span><span class='hs-conid'>Prim</span> <span class='hs-layout'>(</span><span class='hs-varid'>uncheckedShiftL</span><span class='hs-cpp'>#</span><span class='hs-layout'>,</span> <span class='hs-varid'>uncheckedShiftRL</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<a name="line-22"></a>
<a name="line-23"></a><span class='hs-comment'>-- The highestBitMask implementation is based on</span>
<a name="line-24"></a><span class='hs-comment'>-- <a href="http://graphics.stanford.edu/~seander/bithacks.html#RoundUpPowerOf2">http://graphics.stanford.edu/~seander/bithacks.html#RoundUpPowerOf2</a></span>
<a name="line-25"></a><span class='hs-comment'>-- which has been put in the public domain.</span>
<a name="line-26"></a>
<a name="line-27"></a><a name="highestBitMask"></a><span class='hs-comment'>-- | Return a word where only the highest bit is set.</span>
<a name="line-28"></a><span class='hs-definition'>highestBitMask</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word</span>
<a name="line-29"></a><span class='hs-definition'>highestBitMask</span> <span class='hs-varid'>x1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x7</span> <span class='hs-varop'>`xor`</span> <span class='hs-layout'>(</span><span class='hs-varid'>x7</span> <span class='hs-varop'>`shiftRL`</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-30"></a>  <span class='hs-varid'>x2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x1</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>shiftRL</span> <span class='hs-varid'>x1</span> <span class='hs-num'>1</span>
<a name="line-31"></a>  <span class='hs-varid'>x3</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x2</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>shiftRL</span> <span class='hs-varid'>x2</span> <span class='hs-num'>2</span>
<a name="line-32"></a>  <span class='hs-varid'>x4</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x3</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>shiftRL</span> <span class='hs-varid'>x3</span> <span class='hs-num'>4</span>
<a name="line-33"></a>  <span class='hs-varid'>x5</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x4</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>shiftRL</span> <span class='hs-varid'>x4</span> <span class='hs-num'>8</span>
<a name="line-34"></a>  <span class='hs-varid'>x6</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x5</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>shiftRL</span> <span class='hs-varid'>x5</span> <span class='hs-num'>16</span>
<a name="line-35"></a>  <span class='hs-varid'>x7</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x6</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>shiftRL</span> <span class='hs-varid'>x6</span> <span class='hs-num'>32</span>
<a name="line-36"></a><span class='hs-comment'>{-# inline highestBitMask #-}</span>
<a name="line-37"></a>
<a name="line-38"></a><a name="shiftRL"></a><span class='hs-comment'>-- Right and left logical shifts.</span>
<a name="line-39"></a><span class='hs-definition'>shiftRL</span><span class='hs-layout'>,</span> <span class='hs-varid'>shiftLL</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word</span>
<a name="line-40"></a><span class='hs-definition'>shiftRL</span> <span class='hs-layout'>(</span><span class='hs-conid'>W</span><span class='hs-cpp'>#</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>W</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>uncheckedShiftRL</span><span class='hs-cpp'>#</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-41"></a><a name="shiftLL"></a><span class='hs-definition'>shiftLL</span> <span class='hs-layout'>(</span><span class='hs-conid'>W</span><span class='hs-cpp'>#</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>W</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>uncheckedShiftL</span><span class='hs-cpp'>#</span>  <span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-42"></a><span class='hs-comment'>{-# inline CONLIKE shiftRL #-}</span>
<a name="line-43"></a><span class='hs-comment'>{-# inline CONLIKE shiftLL #-}</span>
<a name="line-44"></a>
<a name="line-45"></a><a name="wordSize"></a><span class='hs-definition'>wordSize</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span>
<a name="line-46"></a><span class='hs-definition'>wordSize</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>finiteBitSize</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word</span><span class='hs-layout'>)</span>
<a name="line-47"></a><span class='hs-comment'>{-# inline wordSize #-}</span>
</pre></body>
</html>
